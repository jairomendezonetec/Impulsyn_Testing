{"version":3,"sources":["./src/app/signup-flow/location/location.page.html","./src/app/base/profile-image-editor-base.page.ts","./src/app/signup-flow/location/location-routing.module.ts","./src/app/signup-flow/location/location.module.ts","./src/app/signup-flow/location/location.page.scss","./src/app/signup-flow/location/location.page.ts"],"names":[],"mappings":"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","file":"signup-flow-location-location-module.js","sourcesContent":["export default \"<app-header [showBackButton]=\\\"showBackButton\\\" [titleImage]=\\\"logoPath\\\" (backButtonClick)=\\\"goBack()\\\"></app-header>\\n\\n<ion-content class=\\\"ion-padding background-with-dark-color\\\">\\n  <ion-grid class=\\\"flex-container\\\">\\n    <ion-row class=\\\"flex-item ion-margin-vertical\\\">\\n      <ion-col size=\\\"12\\\" class=\\\"ion-text-center\\\">\\n        <div class=\\\"screen-extrabig-title\\\" [innerHTML]=\\\"'location.title' | translate\\\"></div>\\n      </ion-col>\\n    </ion-row>\\n    <app-device-location\\n      [buttonText]=\\\"'next'\\\"\\n      [deviceLocation]=\\\"geocodeResult\\\"\\n      (actionButtonClick)=\\\"saveLocation($event)\\\"\\n    ></app-device-location>\\n    <ion-row class=\\\"flex-item ion-align-items-center w100 ion-justify-content-center\\\">\\n      <div class=\\\"col-xs-10 col-sm-6 col-lg-6 ion-text-center flex-container-vertical\\\">\\n        <a color=\\\"white\\\" class=\\\"ion-padding-vertical small-size\\\" (click)=\\\"skip()\\\">{{'skip' | translate}}</a>\\n      </div>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\";","import { Location } from '@angular/common';\nimport { Router } from '@angular/router';\nimport { SafeUrl } from '@angular/platform-browser';\nimport { Store } from '@ngxs/store';\nimport { Camera } from '@ionic-native/camera/ngx';\n\nimport { UtilsService } from '../@core/utils.service';\nimport { BasePage } from './base.page';\nimport { Utils } from '../@global/utils';\nimport { InformService } from '../@core/inform.service';\n\nexport class ProfileImageEditorBasePage extends BasePage {\n  public profileImage: SafeUrl;\n  public imageOriginalPath: string;\n\n  constructor(\n    location: Location,\n    router: Router,\n    store: Store,\n    utilsService: UtilsService,\n    protected camera: Camera,\n    protected informService: InformService\n  ) {\n    super(location, router, store, utilsService);\n  }\n\n  protected pickImageGallery = () => {\n    this.pickImage(this.camera.PictureSourceType.PHOTOLIBRARY);\n  };\n\n  protected pickImageCamera = () => {\n    this.pickImage(this.camera.PictureSourceType.CAMERA);\n  };\n\n  protected async pickImage(sourceType: number): Promise<void> {\n    try {\n      const imageData = await this.utilsService.getMediaFromCameraPlugin(sourceType, this.camera.MediaType.PICTURE);\n\n      const { path, filename } = Utils.getPathAndFilenameFromUrl(imageData.imageOriginalPath);\n      const file = await this.utilsService.getFileFromSystemPath(path, filename);\n\n      if (!Utils.isImageMediaType(file.type)) {\n        this.informService.showWarning('createPost.wrongImageType');\n        return;\n      }\n\n      this.imageOriginalPath = imageData.imageOriginalPath;\n      this.profileImage = imageData.imageSource;\n    } catch (error) {\n      console.error('[ProfileImageEditorBasePage pickImage] error taking a picture');\n      console.error(error);\n\n      const capturedError = new Error('Error in pickImage: ' + error);\n      capturedError.name = '[ProfileImageEditorBasePage error]';\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { LocationPage } from './location.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: LocationPage,\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class LocationPageRoutingModule {}\n","import { NgModule } from '@angular/core';\n\nimport { LocationPageRoutingModule } from './location-routing.module';\n\nimport { LocationPage } from './location.page';\nimport { SharedModule } from '../../@shared/shared.module';\nimport { LocationModule } from '../../@shared/components/location/location.module';\n\n@NgModule({\n  imports: [SharedModule, LocationPageRoutingModule, LocationModule],\n  declarations: [LocationPage],\n})\nexport class LocationPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3NpZ251cC1mbG93L2xvY2F0aW9uL2xvY2F0aW9uLnBhZ2Uuc2NzcyJ9 */\";","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { SignupBasePage } from '../signup-base.page';\nimport { Router } from '@angular/router';\nimport { Location } from '@angular/common';\nimport { Select, Store } from '@ngxs/store';\nimport { UtilsService } from '../../@core/utils.service';\nimport { StorageService } from '../../@core/storage.service';\nimport { NavigationExtrasService } from '../../@core/navigation-extras.service';\nimport { Observable, Subscription } from 'rxjs';\nimport { IElement } from '../../@store/global-info/global-info.model';\nimport { FormGroup } from '@angular/forms';\nimport { NativeGeocoderResult } from '@ionic-native/native-geocoder/ngx';\nimport { Diagnostic } from '@ionic-native/diagnostic/ngx';\nimport { Platform } from '@ionic/angular';\nimport { GetUserCoordinates, GetUserGeolocation } from '../../@store/preferences/preferences.actions';\nimport { PreferencesState } from '../../@store/preferences/preferences.state';\nimport { Coordinates } from '@ionic-native/geolocation';\nimport { GoogleAnalyticsService } from '../../@core/google-analytics.service';\nimport { Camera } from '@ionic-native/camera/ngx';\nimport { InformService } from '../../@core/inform.service';\n\nconst PAGE_POSITION = 5;\n\n@Component({\n  selector: 'app-location',\n  templateUrl: './location.page.html',\n  styleUrls: ['./location.page.scss'],\n})\nexport class LocationPage extends SignupBasePage implements OnInit, OnDestroy {\n  @Select(PreferencesState.getCoordinates) coordinates$: Observable<Coordinates>;\n  @Select(PreferencesState.getGeolocation) geolocation$: Observable<NativeGeocoderResult>;\n\n  private locationSubscription$: Subscription;\n  private geocodeSubscription$: Subscription;\n\n  public formGroup: FormGroup;\n  public countryList: IElement[];\n  public geocodeResult: NativeGeocoderResult;\n  private coordinates: Coordinates;\n  public allowedLocationDetection = false;\n\n  constructor(\n    router: Router,\n    location: Location,\n    store: Store,\n    utilsService: UtilsService,\n    camera: Camera,\n    informService: InformService,\n    storage: StorageService,\n    navigationExtrasService: NavigationExtrasService,\n    googleAnalyticsService: GoogleAnalyticsService,\n    private diagnostic: Diagnostic,\n    private platform: Platform\n  ) {\n    super(\n      location,\n      router,\n      store,\n      utilsService,\n      camera,\n      informService,\n      storage,\n      navigationExtrasService,\n      googleAnalyticsService\n    );\n  }\n\n  ngOnInit() {\n    // override showBackButton\n    this.showBackButton = this.checkGoBack();\n  }\n\n  async ionViewDidEnter() {\n    // if (this.platform.is('cordova')) {\n    //   await this.searchDeviceUserLocation();\n    // }\n  }\n\n  private subscribeToLocationStateChanges() {\n    this.diagnostic.registerLocationStateChangeHandler((state) => {\n      if (\n        (this.platform.is('android') && state !== this.diagnostic.locationMode.LOCATION_OFF) ||\n        (this.platform.is('ios') &&\n          (state === this.diagnostic.permissionStatus.GRANTED ||\n            state === this.diagnostic.permissionStatus.GRANTED_WHEN_IN_USE))\n      ) {\n        this.getUserPosition();\n\n        // deregister, so it is only done once\n        this.diagnostic.registerLocationStateChangeHandler(null);\n      }\n    });\n  }\n\n  private async searchDeviceUserLocation() {\n    try {\n      const isLocationEnabled = await this.diagnostic.isLocationEnabled();\n\n      if (!isLocationEnabled) {\n        await this.utilsService.showActiveLocationAlert();\n        this.subscribeToLocationStateChanges();\n      } else {\n        this.getUserPosition();\n      }\n    } catch (error) {\n      console.error('searchDeviceUserLocation ' + error.message);\n    }\n  }\n\n  private getUserPosition() {\n    this.store.dispatch(new GetUserCoordinates());\n    this.locationSubscription$ = this.coordinates$.subscribe((coordinates: Coordinates) => {\n      if (coordinates) {\n        this.allowedLocationDetection = true;\n        this.coordinates = coordinates;\n        this.store.dispatch(\n          new GetUserGeolocation({\n            latitude: this.coordinates.latitude,\n            longitude: this.coordinates.longitude,\n          })\n        );\n      }\n    });\n    this.geocodeSubscription$ = this.geolocation$.subscribe((data: NativeGeocoderResult) => {\n      if (data) {\n        this.geocodeResult = data;\n      }\n    });\n  }\n\n  public async saveLocation($event) {\n    const location = {\n      country: $event.country?.id,\n      region: $event.region?.id,\n      province: $event.province?.id,\n      city: $event.city,\n      region_name: $event.region_name,\n    };\n\n    await this.updateSignupFlowInfo(PAGE_POSITION, 'location', location);\n    this.goNextFlowPage(PAGE_POSITION);\n  }\n\n  private disconnectObservers(): void {\n    if (this.locationSubscription$) {\n      this.locationSubscription$.unsubscribe();\n    }\n    if (this.geocodeSubscription$) {\n      this.geocodeSubscription$.unsubscribe();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.disconnectObservers();\n  }\n\n  public skip() {\n    // go next page\n    this.goNextFlowPage(PAGE_POSITION);\n  }\n}\n"],"sourceRoot":"webpack:///"}