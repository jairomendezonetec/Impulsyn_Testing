{"version":3,"sources":["./src/app/publication-detail/publication-detail.page.html","./src/app/publication-detail/publication-detail-routing.module.ts","./src/app/publication-detail/publication-detail.module.ts","./src/app/publication-detail/publication-detail.page.scss","./src/app/publication-detail/publication-detail.page.ts"],"names":[],"mappings":"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","file":"publication-detail-publication-detail-module.js","sourcesContent":["export default \"<app-header\\n  [showBackButton]=\\\"true\\\"\\n  [title]=\\\"'publicationDetailPage.title'\\\"\\n  (backButtonClick)=\\\"goBack()\\\"\\n  [actionIconList]=\\\"[headerIcon]\\\"\\n  (actionIconListClick)=\\\"onHeaderIconClick($event)\\\"\\n></app-header>\\n\\n<ion-content>\\n  <div style=\\\"height: 100%; overflow: hidden\\\" id=\\\"detailPublication\\\">\\n    <div class=\\\"size-100\\\">\\n      <div class=\\\"publication-container\\\" *ngIf=\\\"publication\\\">\\n        <app-publication\\n          [i]=\\\"0\\\"\\n          *ngIf=\\\"!isEmpty()\\\"\\n          [buttonList]=\\\"buttonList\\\"\\n          [publication]=\\\"publication\\\"\\n          (buttonClick)=\\\"onPublicationButtonClick($event)\\\"\\n          (showCommentsList)=\\\"showCommentsList($event)\\\"\\n          (showLikesList)=\\\"showLikesList($event)\\\"\\n          [userPhoto]=\\\"publication.publisher.photo\\\"\\n          [isDetail]=\\\"true\\\"\\n        ></app-publication>\\n      </div>\\n    </div>\\n  </div>\\n</ion-content>\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PublicationDetailPage } from './publication-detail.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PublicationDetailPage,\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PublicationDetailPageRoutingModule {}\n","import { NgModule } from '@angular/core';\n\nimport { PublicationDetailPageRoutingModule } from './publication-detail-routing.module';\n\nimport { PublicationDetailPage } from './publication-detail.page';\nimport { PublicationModule } from '../timeline/components/publication/publication.module';\nimport { SharedModule } from '../@shared/shared.module';\n\n@NgModule({\n  imports: [SharedModule, PublicationModule, PublicationDetailPageRoutingModule],\n  declarations: [PublicationDetailPage],\n})\nexport class PublicationDetailPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3B1YmxpY2F0aW9uLWRldGFpbC9wdWJsaWNhdGlvbi1kZXRhaWwucGFnZS5zY3NzIn0= */\";","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { IPublication } from '../@shared/interfaces/publication';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BasePage } from '../base/base.page';\nimport { Location } from '@angular/common';\nimport { Select, Store } from '@ngxs/store';\nimport { UtilsService } from '../@core/utils.service';\nimport { Observable, Subscription } from 'rxjs';\nimport { TimelineState } from '../@store/timeline/timeline.state';\nimport { AddComment, ChangeLikeStatus, GetPublicationDetail } from '../@store/timeline/timeline.actions';\nimport { Utils } from '../@global/utils';\nimport { ION_SHEET_TYPE } from '../timeline/enum/ion-sheet-type';\nimport { Constants } from '../@global/constants';\nimport { PublicationButton } from '../timeline/components/publication/publication.component';\nimport { UserState } from '../@store/user/user.state';\nimport { SocialSharingService } from '../@core/social-sharing.service';\nimport { AlertController, PopoverController } from '@ionic/angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { DeletePublication } from '../@store/profiles/profiles.actions';\nimport { take } from 'rxjs/operators';\nimport { PagesState } from 'src/app/@store/pages/pages.state';\nimport { SetPublication } from '../@store/timeline/timeline.actions';\nimport { IActionIcon } from '../@shared/components/header/header.component';\nimport { PopoverHeaderComponent } from '../profiles/organization/organization-profile/components/popover-header/popover-header.component';\nimport { SetFocusOnPublication } from '../@store/posts/posts.actions';\n\n@Component({\n  selector: 'app-publication-detail',\n  templateUrl: './publication-detail.page.html',\n  styleUrls: ['./publication-detail.page.scss'],\n})\nexport class PublicationDetailPage extends BasePage implements OnInit, OnDestroy {\n  @Select(TimelineState.getPublication) publication$: Observable<IPublication>;\n  public publication: IPublication = null;\n  public publicationId: string;\n  public profileImage: string;\n  public userId: string;\n  private subscription$: Subscription;\n  public isOwner = false;\n  public buttonList: PublicationButton[] = Constants.PUBLICATION_BUTTONS;\n  public headerIcon: IActionIcon;\n\n  public items = null;\n\n  constructor(\n    router: Router,\n    location: Location,\n    store: Store,\n    utilsService: UtilsService,\n    private route: ActivatedRoute,\n    private socialShare: SocialSharingService,\n    private alertController: AlertController,\n    private translateService: TranslateService,\n    private popoverController: PopoverController\n  ) {\n    super(location, router, store, utilsService);\n  }\n\n  ngOnInit(): void {\n    this.subscribeToPublication();\n  }\n\n  ionViewWillEnter() {\n    this.profileImage = this.store.selectSnapshot(UserState.getUserInfo)?.photo;\n    this.publicationId = this.route.snapshot.params['id'];\n    this.loadPublication();\n    this.store.dispatch(new SetFocusOnPublication(false));\n  }\n\n  private loadPublication(): void {\n    this.store.dispatch(new GetPublicationDetail({ id: this.publicationId }));\n  }\n\n  private subscribeToPublication(): void {\n    this.subscription$ = this.publication$.subscribe((data) => {\n      this.publication = data;\n      this.userId = this.store.selectSnapshot(UserState.getUserInfo)?.id;\n      this.isOwner = this.isPublicationOwner();\n      this.headerIcon = {\n        name: this.isOwner ? 'ellipsis-vertical' : '',\n      };\n    });\n  }\n\n  public onHeaderIconClick($event) {\n    if (this.isOwner) {\n      this.showPopover($event);\n    }\n  }\n\n  public async showPopover(params) {\n    const items = [\n      {\n        text: 'publicationDetailPage.delete',\n        color: 'danger',\n      },\n    ];\n    const popover = await this.popoverController.create({\n      event: params.event,\n      component: PopoverHeaderComponent,\n      componentProps: { items },\n      cssClass: 'menu-popover',\n      translucent: true,\n    });\n\n    popover.onDidDismiss().then((result) => {\n      if (result.data === 0) {\n        this.deletePublication(this.publicationId);\n      }\n    });\n\n    await popover.present();\n  }\n\n  ngOnDestroy(): void {\n    this.publication = null;\n    this.store.dispatch(new SetPublication(null));\n    this.disconnectObservers();\n  }\n\n  private isPublicationOwner(): boolean {\n    const userPageIds = this.store.selectSnapshot(PagesState.getUserPageList).map((el) => el.id);\n    return this.publication?.publisher?.id === this.userId || userPageIds.includes(this.publication?.publisher?.id);\n  }\n\n  private disconnectObservers(): void {\n    if (this.subscription$) {\n      this.subscription$.unsubscribe();\n    }\n  }\n\n  public onPublicationButtonClick($event) {\n    const buttonPosition: number = $event.buttonPosition;\n    const publicationId: string = $event.publicationId;\n\n    this.publicationId = publicationId;\n\n    switch (buttonPosition) {\n      case 0: // likes\n        this.changeLikeStatus(publicationId);\n        break;\n      case 1: // comments\n        this.showCommentsList(publicationId);\n        break;\n      case 2: // share outside\n        this.socialShare.sharePublication(publicationId);\n        break;\n      // case 3: // share on impulsyn\n      //   break;\n    }\n  }\n\n  private changeLikeStatus(publicationId: string) {\n    this.store.dispatch(new ChangeLikeStatus({ id: publicationId, like: !this.publication.like }));\n  }\n\n  public showLikesList(publicationId) {\n    this.publicationId = publicationId;\n    this.utilsService.openIonSheet(ION_SHEET_TYPE.LIKES, this.publicationId);\n  }\n\n  public showCommentsList(publicationId) {\n    this.publicationId = publicationId;\n    this.utilsService.openIonSheet(ION_SHEET_TYPE.COMMENTS, this.publicationId);\n  }\n\n  private async deletePublication(publicationId: string) {\n    const message = await this.translateService.get('publicationDetailPage.deleteConfirm').toPromise();\n\n    const alert = await this.alertController.create({\n      cssClass: 'custom-alert',\n      message,\n      buttons: [\n        {\n          text: this.translateService.instant(`buttons.cancel`),\n          role: 'cancel',\n          cssClass: 'secondary',\n          handler: () => {\n            // do nothing\n          },\n        },\n        {\n          text: this.translateService.instant(`buttons.accept`),\n          handler: () => {\n            this.store\n              .dispatch(new DeletePublication(publicationId))\n              .pipe(take(1))\n              .subscribe(() => {\n                this.goBack();\n              });\n          },\n        },\n      ],\n    });\n\n    await alert.present();\n  }\n\n  isEmpty() {\n    return Utils.isEmpty(this.publication);\n  }\n\n  public newComment(comment) {\n    this.store.dispatch(new AddComment(comment, this.publicationId));\n  }\n}\n"],"sourceRoot":"webpack:///"}